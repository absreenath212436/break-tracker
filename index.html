<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Magical Team Break Tracker - Enhanced</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #f0f0f0;
    margin: 0; padding: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 40px 20px;
  }
  #app {
    max-width: 960px;
    width: 100%;
    background: #112d4e;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.7);
    padding: 30px;
  }
  h2 {
    margin-bottom: 24px;
    text-align: center;
    font-weight: 700;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    color: #9bd1fc;
  }
  .user-row {
    background: #1c497a;
    border-radius: 16px;
    padding: 18px 24px;
    margin-bottom: 22px;
    display: flex;
    align-items: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .user-row:hover {
    transform: scale(1.03);
    box-shadow: 0 10px 35px rgba(255, 157, 0, 0.7);
  }
  .user-row.onbreak {
    animation: glowPulse 2.5s infinite ease-in-out;
    border: 2px solid #fca311;
    background: linear-gradient(90deg, #fca311aa, #f7b733aa);
    color: #221f1f;
    box-shadow: 0 0 12px 3px #fca311cc;
  }
  @keyframes glowPulse {
    0%, 100% { box-shadow: 0 0 12px 3px #fca311cc; }
    50% { box-shadow: 0 0 25px 6px #fca311ff; }
  }
  .user-avatar {
    width: 96px;
    height: 96px;
    border-radius: 20px;
    overflow: hidden;
    margin-right: 24px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    transition: transform 0.5s ease;
  }
  .user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: drop-shadow(0 3px 4px rgba(0,0,0,0.6));
    transition: transform 0.5s ease;
    border-radius: 20px;
  }
  .user-row.onbreak .user-avatar img {
    animation: avatarBounce 2s infinite ease-in-out;
  }
  @keyframes avatarBounce {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-10px) scale(1.05); }
  }
  .user-info {
    flex: 1;
  }
  .user-name {
    font-weight: 700;
    font-size: 1.25em;
    margin-bottom: 6px;
    letter-spacing: 0.7px;
  }
  .user-status {
    font-size: 1.1em;
    margin-bottom: 6px;
    font-weight: 600;
    color: #ffe066;
  }
  .break-summary {
    font-size: 0.95em;
    font-weight: 500;
    color: #d6d6d6;
  }
  .break-controls {
    margin-left: 24px;
  }
  .break-controls button {
    background: linear-gradient(45deg,#fca311 0%, #ff6700 100%);
    border: none;
    border-radius: 12px;
    color: #130f40;
    font-weight: 700;
    padding: 11px 22px;
    margin-bottom: 8px;
    cursor: pointer;
    box-shadow: 0 5px 12px #fa6900aa;
    transition: background-color 0.3s ease;
    width: 140px;
    user-select: none;
  }
  .break-controls button:disabled {
    background: #6e6e6e;
    cursor: not-allowed;
    box-shadow: none;
    color: #ccc;
  }
  .break-controls button:hover:not(:disabled) {
    background: linear-gradient(45deg,#ff8500 0%, #ffa41b 100%);
  }
  .dashboard-quote {
    font-style: italic;
    font-weight: 600;
    text-align: center;
    margin-bottom: 28px;
    color: #ffd60a;
    text-shadow: 0 0 7px rgba(255,214,10,0.7);
  }
  .avatar-picker {
    margin-top: 16px;
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(72px,1fr));
    gap: 12px;
    justify-items: center;
  }
  .avatar-opt {
    width: 72px;
    height: 72px;
    border-radius: 18px;
    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 6px 15px rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 3px solid transparent;
    background: linear-gradient(30deg, #3069c9, #4299e1);
  }
  .avatar-opt img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  .avatar-opt.selected {
    border-color: #fca311;
    transform: scale(1.1);
    box-shadow: 0 0 12px 4px #fca311dd;
  }
  /* Form style */
  form label {
    font-weight: 600;
    margin-top: 14px;
    margin-bottom: 6px;
    display: block;
    color: #cde1f9;
  }
  form input[type=password], form select {
    width: 100%;
    font-size: 1.1em;
    padding: 11px 14px;
    border-radius: 10px;
    border: none;
    box-shadow: inset 0 0 6px rgba(111, 132, 180, 0.8);
    background: #1f366b;
    color: #e0ecff;
    outline: none;
    transition: box-shadow 0.3s ease;
  }
  form input[type=password]:focus, form select:focus {
    box-shadow: inset 0 0 8px 2px #fca311;
  }
  .btn {
    margin-top: 24px;
    background: linear-gradient(45deg,#fca311,#ff7f11);
    font-size: 1.1em;
    border: none;
    color: #130f40;
    border-radius: 14px;
    padding: 14px;
    cursor: pointer;
    font-weight: 700;
    box-shadow: 0 5px 14px #ff7f1144;
    user-select: none;
    transition: background 0.3s ease;
  }
  .btn:hover, .btn:focus {
    background: linear-gradient(45deg,#ffa726,#ffc107);
  }
  .error {
    margin-top: 12px;
    color: #ff8a80;
    font-weight: 700;
  }
  .small-link {
    color: #fca311;
    font-size: 0.95em;
    cursor: pointer;
    text-decoration: underline;
    display: inline-block;
    margin-top: 10px;
  }
  .dashboard-summary {
    margin-top: 40px;
    color: #c4c4c4;
  }
  /* Scroll for long tables */
  .break-dashboard-result {
    max-height: 350px;
    overflow-y: auto;
    margin-top: 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: #1c2e50;
    border-radius: 12px;
    overflow: hidden;
  }
  th, td {
    padding: 12px 16px;
    text-align: center;
    font-weight: 600;
  }
  th {
    background: #3069c9;
    color: #e0ebff;
    text-transform: uppercase;
    font-size: 0.9em;
  }
  td {
    color: #d0dafc;
    border-bottom: 1px solid #25468e;
  }
  /* Scrollbar styling */
  .break-dashboard-result::-webkit-scrollbar {
    width: 8px;
  }
  .break-dashboard-result::-webkit-scrollbar-track {
    background: #112d4e;
    border-radius: 8px;
  }
  .break-dashboard-result::-webkit-scrollbar-thumb {
    background: #fca311aa;
    border-radius: 8px;
  }
</style>
</head>
<body>
  <div id="app"></div>
<script>
  // Sample 3D-ish avatars URLs (replace with your actual 3D avatar images)
  const avatars = [
    'https://i.imgur.com/TlQ5vZI.png', // 3D avatar 1
    'https://i.imgur.com/zXVY7RG.png', // 3D avatar 2
    'https://i.imgur.com/YHmzOwB.png', // 3D avatar 3
    'https://i.imgur.com/gJe66dQ.png', // 3D avatar 4
    'https://i.imgur.com/cqjQWOX.png', // 3D avatar 5
    'https://i.imgur.com/A2nXNm2.png', // 3D avatar 6
    'https://i.imgur.com/7n6CoAT.png', // 3D avatar 7
    'https://i.imgur.com/QF6gEJ0.png', // 3D avatar 8
    'https://i.imgur.com/R4J2pQS.png', // 3D avatar 9
    'https://i.imgur.com/bkws71O.png', // 3D avatar 10
    'https://i.imgur.com/BfHZKj9.png', // 3D avatar 11
    'https://i.imgur.com/2PsfhHu.png', // 3D avatar 12
    'https://i.imgur.com/n3J1R3e.png', // 3D avatar 13
    'https://i.imgur.com/rKwozub.png', // 3D avatar 14
    'https://i.imgur.com/ywrSJOY.png', // 3D avatar 15
  ];

  const teamMembers = [
    {name:"Asha AS", email:"asha.as@opendoor.com", empid:"010293"},
    {name:"Revathi Kumar", email:"revathi.kumar@opendoor.com", empid:"010113"},
    {name:"Pranesh Krishnamoorthy", email:"pranesh.krishnamoorthy@opendoor.com", empid:"009771"},
    {name:"Sheeba Rani D", email:"sheeba.rani.d@opendoor.com", empid:"009741"},
    {name:"Subham E", email:"subham.e@opendoor.com", empid:"010290"},
    {name:"Sunmathy Wilson", email:"sunmathy.wilson@opendoor.com", empid:"009753"},
    {name:"Trilokes Sahu", email:"trilokes.sahu@opendoor.com", empid:"009734"},
    {name:"Udhaya Kumari", email:"udhaya.kumari@opendoor.com", empid:"010242"},
    {name:"Afredi", email:"afredi.a@opendoor.com", empid:"009426"},
    {name:"Akshaya Narayanan", email:"akshaya.narayanan@opendoor.com", empid:"009495"},
    {name:"Gopal M", email:"gopal.m@opendoor.com", empid:"009443"},
    {name:"Kamesh D", email:"d.kamesh@opendoor.com", empid:"010193"},
    {name:"Manikandan M", email:"manikandan.m@opendoor.com", empid:"009516"},
    {name:"Nirosha Banu", email:"nirosha.banu@opendoor.com", empid:"009810"},
    {name:"Savitha E", email:"savitha.e@opendoor.com", empid:"009464"},
    {name:"Ramya Bharathi. R", email:"ramya.bharathir@opendoor.com", empid:"009818"},
    {name:"Muzammil Ahamed Hussain", email:"muzammil.ahamedhussain@opendoor.com", empid:"010264"},
    {name:"Srinivasan N", email:"srinivasan.n@opendoor.com", empid:"010266"},
    {name:"Vinod Kumar", email:"vinod.kumar@opendoor.com", empid:"008459"},
    {name:"Sreenath", email:"sreenath.ab@opendoor.com", empid:"008526"},
  ];

  const motivational = [
    "ðŸŒŸ Take a magical break! You deserve it.",
    "Breathe, relaxâ€”your creativity is restoring.",
    "Stretch, smile, count stars!",
    "Great work! Time to recharge.",
    "Have a magical day, friend! âœ¨",
    "ðŸŒ¿ A short break now builds big energy later.",
    "ðŸš€ Pause. Reset. Come back stronger.",
    "Your mind deserves calm as much as your body. ðŸ’†",
    "âœ¨ Small breaks = big wins.",
    "â˜• Coffee + a pause = productivity boost.",
    "ðŸŒŠ Breathe deep like the ocean, let stress float away.",
    "ðŸ“– Close your eyes, imagine your happy place.",
    "ðŸ’¡ Breaks spark new ideas. Let your mind wander.",
    "ðŸŒ» Relax and bloom again with energy.",
    "ðŸŽ¶ Take a pause, maybe hum your favorite tune!",
    "ðŸŒˆ Break = Brainâ€™s rainbow recharge.",
    "ðŸ’– Self-care isnâ€™t selfish. Take 5 for you.",
    "ðŸŽ¯ Rest now, hit goals sharper later.",
    "ðŸŒ Step back, breathe, the world waits for you.",
    "ðŸ”¥ Breaks arenâ€™t stopping, theyâ€™re fueling your fire!"
  ];

  function getUsers() {return JSON.parse(localStorage.getItem('bt_users')||"[]");}
  function saveUsers(u){localStorage.setItem('bt_users',JSON.stringify(u));}
  function getCurrentEmpid(){return localStorage.getItem('bt_current_empid');}
  function setCurrentEmpid(id){localStorage.setItem('bt_current_empid',id);}
  function clearCurrentEmpid(){localStorage.removeItem('bt_current_empid');}
  function findUser(empid){return getUsers().find(u=>u.empid===empid);}
  function mins(ms){return Math.floor(ms/60000);}
  function todayKey(){return new Date().toISOString().slice(0,10);}
  function getTodayLogs(u){if(!u||!u.logs)return[];return u.logs.filter(l=>l.date===todayKey());}

  // Auto-fill name/email/empid information on select change
  function autoFillFields(selId, nameId, emailId, empidId) {
    const sel = document.getElementById(selId);
    const nameF = document.getElementById(nameId);
    const emailF = document.getElementById(emailId);
    const empidF = document.getElementById(empidId);
    sel.onchange = () => {
      const m = teamMembers.find(t => t.name === sel.value);
      if (m) {
        nameF.textContent = m.name;
        emailF.textContent = m.email;
        empidF.textContent = m.empid;
      }
    };
    sel.dispatchEvent(new Event('change'));
  }

  function showAvatarOptions(containerId, hiddenInputId, currentIdx) {
    const cont = document.getElementById(containerId);
    cont.innerHTML = avatars.map((url, i) =>
      `<div class="avatar-opt${currentIdx === i ? ' selected' : ''}" data-idx="${i}"><img src="${url}" alt="avatar-${i + 1}" /></div>`
    ).join('');
    let hid = document.getElementById(hiddenInputId);
    if (!hid) {
      hid = document.createElement("input");
      hid.type = "hidden";
      hid.id = hiddenInputId;
      cont.parentNode.appendChild(hid);
    }
    function select(idx) {
      cont.querySelectorAll(".avatar-opt").forEach(e => e.classList.remove('selected'));
      const el = cont.querySelector(`.avatar-opt[data-idx="${idx}"]`);
      if (el) el.classList.add('selected');
      hid.value = idx;
    }
    cont.querySelectorAll(".avatar-opt").forEach((el, i) => {
      el.onclick = () => select(i);
    });
    select(currentIdx == null ? 0 : currentIdx);
    hid.value = currentIdx == null ? 0 : currentIdx;
  }

  function showRegister(error = "") {
    app.innerHTML =
      `<div class="centered fade-in" style="background: transparent; box-shadow:none; padding:0;">
        <h2>Register</h2>
        <form autocomplete="off">
          <label for="nameSel">Select Name</label>
          <select id="nameSel" required>
            ${teamMembers.map(m => `<option>${m.name}</option>`).join('')}
          </select>
          <label>Name</label>
          <div id="regName" class="info-field"></div>
          <label>Email</label>
          <div id="regEmail" class="info-field"></div>
          <label>Emp ID</label>
          <div id="regEmpId" class="info-field"></div>
          <label>Pick Your Magical Avatar</label>
          <div class="avatar-picker" id="avatarPickerRegister"></div>
          <input type="hidden" id="regAvatarIdx" value="0"/>
          <label>Password</label>
          <input id="regPwd" type="password" placeholder="Create password" required minlength="4"/>
          <button type="submit" class="btn">Register</button>
        </form>
        <div class="error">${error}</div>
        <span class="small-link" onclick="showLogin()">Already registered? Login</span>
      </div>`;
    autoFillFields("nameSel", "regName", "regEmail", "regEmpId");
    showAvatarOptions("avatarPickerRegister", "regAvatarIdx");
    document.querySelector('form').onsubmit = function (e) {
      e.preventDefault();
      const name = document.getElementById("nameSel").value;
      const email = document.getElementById("regEmail").textContent;
      const empid = document.getElementById("regEmpId").textContent;
      const avatarIdx = parseInt(document.getElementById("regAvatarIdx").value, 10);
      const pwd = document.getElementById("regPwd").value.trim();
      let users = getUsers();
      if (users.some(u => u.empid === empid)) {
        showRegister("EMP ID already registered!"); return;
      }
      if (pwd.length < 4) {
        showRegister("Password must be at least 4 chars."); return;
      }
      users.push({ name, email, empid, password: pwd, avatarIdx, logs: [], lastLogin: new Date().toISOString() });
      saveUsers(users);
      setCurrentEmpid(empid);
      showDashboard();
    };
  }

  function showLogin(error = "") {
    app.innerHTML =
      `<div class="centered fade-in" style="background: transparent; box-shadow:none; padding:0;">
        <h2>Login</h2>
        <form autocomplete="off">
          <label for="nameLoginSel">Select Name</label>
          <select id="nameLoginSel" required>
            ${teamMembers.map(m => `<option>${m.name}</option>`).join('')}
          </select>
          <label>Name</label>
          <div id="loginName" class="info-field"></div>
          <label>Email</label>
          <div id="loginEmail" class="info-field"></div>
          <label>Emp ID</label>
          <div id="loginEmpId" class="info-field"></div>
          <label>Password</label>
          <input id="loginPwd" type="password" placeholder="Enter password" required />
          <button type="submit" class="btn">Login</button>
        </form>
        <div class="error">${error}</div>
        <span class="small-link" onclick="showRegister()">First time? Register</span>
      </div>`;
    autoFillFields("nameLoginSel", "loginName", "loginEmail", "loginEmpId");
    document.querySelector('form').onsubmit = function (e) {
      e.preventDefault();
      const empid = document.getElementById("loginEmpId").textContent;
      const pwd = document.getElementById("loginPwd").value.trim();
      let users = getUsers();
      const user = users.find(u => u.empid === empid);
      if (!user || user.password !== pwd) { showLogin("Invalid EMP ID or password."); return; }
      setCurrentEmpid(empid);
      user.lastLogin = new Date().toISOString();
      let idx = users.findIndex(u => u.empid === empid);
      users[idx] = user; saveUsers(users);
      showDashboard();
    };
  }

  function showDashboard(changeAvatarMode) {
    const users = getUsers();
    const currentEmpid = getCurrentEmpid();
    if (!currentEmpid) { showLogin(); return; }
    let usersDict = {}; users.forEach(u => usersDict[u.empid] = u);
    const currentUser = usersDict[currentEmpid];
    const randomQuote = motivational[Math.floor(Math.random() * motivational.length)];

    app.innerHTML =
      `<div class="dashboard fade-in">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h2>Team Dashboard</h2>
          <button class="btn" style="width:auto;padding: 6px 16px; font-size:1em;" onclick="logout()">Logout</button>
        </div>
        <div class="dashboard-quote">${randomQuote}</div>
        ${changeAvatarMode && currentUser ? `
          <div class="avatar-change-panel">
            <label style="font-size:1.1em; color:#ffd60a;">Change Your Avatar</label>
            <div class="avatar-picker" id="avatarPickerChange"></div>
            <input type="hidden" id="avatarIdxChange" value="${currentUser.avatarIdx || 0}"/>
            <button class="btn avatar-change-btn" onclick="saveChangedAvatar()">Save Avatar</button>
            <button class="btn" style="background:#354f7d;color:#ccddee;margin-top:10px;" onclick="showDashboard()">Cancel</button>
          </div>`
          : `<button class="btn avatar-change-btn" style="max-width:220px;margin:14px 0 24px;" onclick="showDashboard(true)">Change My Avatar</button>`}
        ${teamMembers.map(tm => {
          const user = usersDict[tm.empid];
          if (!user) return `
            <div class="user-row">
              <div class="user-avatar"></div>
              <div class="user-info">
                <div class="user-name">${tm.name} (${tm.empid})</div>
                <div class="user-status" style="color:#f08080;">Not Registered</div>
              </div>
            </div>`;
          const logs = getTodayLogs(user);
          const activeBreak = logs.find(l => l.type === "break" && !l.end);
          let lastBreakMin = "-", totalBreakMin = 0;
          logs.filter(l => l.type === "break" && l.end).forEach(l => {
            totalBreakMin += mins(l.end - l.start); lastBreakMin = mins(l.end - l.start);
          });
          const breakLeft = Math.max(60 - totalBreakMin, 0);
          let status = activeBreak ? "On Break" : "Working", rowClass = activeBreak ? "onbreak" : "";
          let controls = "";
          if (user.empid === currentEmpid) {
            controls =
              `<div class="break-controls">
                <button onclick="startBreak()" ${activeBreak ? "disabled" : ""}>Start Break</button>
                <button onclick="endBreak()" ${activeBreak ? "" : "disabled"}>End Break</button>
              </div>`;
          }
          return `
            <div class="user-row ${rowClass}">
              <div class="user-avatar">
                <img src="${avatars[user.avatarIdx]}" alt="avatar" />
              </div>
              <div class="user-info">
                <div class="user-name">${tm.name} (${tm.empid})${user.empid === currentEmpid ? " <b>(You)</b>" : ""}</div>
                <div class="user-status">${status}</div>
                <div class="break-summary">Last break: ${lastBreakMin !== "-" ? lastBreakMin + " min" : "â€”"} | Break left: ${breakLeft} min</div>
                ${controls}
              </div>
            </div>`;
        }).join('')}
      </div>`;

    if (changeAvatarMode && currentUser) {
      showAvatarOptions("avatarPickerChange", "avatarIdxChange", currentUser.avatarIdx);
    }

    showBreakDashboard(); // Optional: keep your break history/dashboard filters here if you added before
  }

  window.saveChangedAvatar = () => {
    const currentEmpid = getCurrentEmpid();
    let users = getUsers();
    const user = users.find(u => u.empid === currentEmpid);
    const newIdx = parseInt(document.getElementById("avatarIdxChange").value, 10);
    if (!isNaN(newIdx)) {
      user.avatarIdx = newIdx;
      saveUsers(users);
    }
    showDashboard();
  };

  function startBreak() {
    const currentEmpid = getCurrentEmpid();
    let users = getUsers();
    const user = users.find(u => u.empid === currentEmpid);
    endBreak();
    user.logs.push({date: todayKey(), type: "break", start: Date.now()});
    saveUsers(users);
    showMagicBurst();
    showDashboard();
  }
  function endBreak() {
    const currentEmpid = getCurrentEmpid();
    let users = getUsers();
    const user = users.find(u => u.empid === currentEmpid);
    const active = user.logs.find(l => l.date === todayKey() && l.type === "break" && !l.end);
    if (active) active.end = Date.now();
    saveUsers(users);
    showMagicBurst();
    showDashboard();
  }
  function logout() {
    clearCurrentEmpid();
    showLogin();
  }
  function showMagicBurst() {
    let burst = document.createElement("div");
    burst.className = "particles";
    burst.innerHTML = Array(20).fill(0).map(() => `<span class="particle" style="
      background: hsl(${Math.random()*360},80%,60%);
      left:${Math.random()*160-80}px; top:${Math.random()*90-45}px;
      --tx:${Math.random()*140-70}px; --ty:${Math.random()*90-45}px;
    "></span>`).join('');
    document.body.appendChild(burst);
    setTimeout(() => burst.remove(), 950);
  }

  var app = document.getElementById("app");
  function boot() {
    if (getCurrentEmpid()) showDashboard();
    else showLogin();
  }
  boot();
  window.showLogin = showLogin;
  window.showRegister = showRegister;
  window.showDashboard = showDashboard;
  window.startBreak = startBreak;
  window.endBreak = endBreak;
  window.logout = logout;

  // --- Optional: keep your break filters/dashboard here (adapt if you want) ---

  function daysAgo(n) {
    const d = new Date();
    d.setDate(d.getDate() - n);
    return d.toISOString().slice(0, 10);
  }
  function showBreakDashboard() {
    // Your break history and filters can be re-added here with updated styles if you want
  }
</script>
</body>
</html>

